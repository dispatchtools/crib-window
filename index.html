<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crib Window Viewer</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      margin-bottom: 0.2rem;
    }
    .time-now {
      font-size: 0.9rem;
      margin-bottom: 1rem;
      color: #555;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .card {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      min-width: 260px;
      flex: 1;
    }
    .card h2 {
      margin-top: 0;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    .shift-row {
      margin: 0.25rem 0;
      padding: 0.25rem 0.4rem;
      border-radius: 4px;
      background: #eef4ff;
      font-size: 0.95rem;
    }
    .empty {
      color: #999;
      font-style: italic;
    }
    .note {
      margin-top: 1rem;
      font-size: 0.85rem;
      color: #666;
    }

    /* Flying image animation */
    #animContainer {
      position: fixed;
      top: 10px;
      right: -200px; /* start just off the right side */
      z-index: 9999;
      pointer-events: none;
    }
    #animContainer img {
      height: 60px;
    }
    .animate {
      animation: fly-across 1.5s linear forwards;
    }
    @keyframes fly-across {
      0% {
        transform: translateX(0);
        opacity: 1;
      }
      100% {
        transform: translateX(-120vw); /* move across entire screen */
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <h1>Who is in a crib window right now?</h1>
  <div class="time-now" id="timeNow"></div>

  <div class="container">
    <div class="card">
      <h2>In crib window</h2>
      <div id="inCribList"></div>
    </div>

    <div class="card">
      <h2>Crib windows starting in next 5 minutes</h2>
      <div id="startingSoonList"></div>
    </div>

    <div class="card">
      <h2>Dropped out in last 30 minutes</h2>
      <div id="droppedList"></div>
    </div>
  </div>

  <div class="note">
    Crib windows end 30 minutes earlier than the original table. Page updates every 10 seconds.
  </div>

  <!-- Flying image container -->
  <div id="animContainer">
    <!-- If you rename the file, change the src here -->
    <img src="Untitled design.svg" alt="crib change">
  </div>

  <script>
    // SHIFT TABLE (crib windows end 30 mins earlier)
    const shifts = [
      { shift: "0700-1700", crib1: "1100-1330", crib2: null },
      { shift: "0700-1900", crib1: "1100-1330", crib2: "1500-1730" },
      { shift: "1000-2200", crib1: "1400-1630", crib2: "1800-2030" },

      { shift: "0545-1800", crib1: "0945-1215", crib2: "1345-1615" },
      { shift: "0600-1815", crib1: "1000-1230", crib2: "1400-1630" },
      { shift: "0645-1900", crib1: "1045-1315", crib2: "1445-1715" },
      { shift: "0715-1830", crib1: "1115-1345", crib2: "1515-1745" },
      { shift: "0745-2000", crib1: "1145-1415", crib2: "1545-1815" },

      { shift: "0945-2200", crib1: "1345-1615", crib2: "1745-2015" },
      { shift: "1045-2300", crib1: "1445-1715", crib2: "1845-2115" },
      { shift: "1145-0000", crib1: "1545-1815", crib2: "1945-2215" },

      { shift: "1745-0600", crib1: "2145-0015", crib2: "0145-0415" },
      { shift: "1800-0615", crib1: "2200-0030", crib2: "0200-0430" },
      { shift: "1845-0700", crib1: "2245-0115", crib2: "0245-0515" },
      { shift: "1915-0730", crib1: "2315-0145", crib2: "0315-0545" }
    ];

    // ---- TIME HELPERS ----
    function toMinutes(hhmm) {
      const h = parseInt(hhmm.slice(0, 2), 10);
      const m = parseInt(hhmm.slice(2), 10);
      return h * 60 + m;
    }

    function parseRange(rangeStr) {
      const [startStr, endStr] = rangeStr.split("-");
      return { start: toMinutes(startStr), end: toMinutes(endStr) };
    }

    function isNowInRange(rangeStr, nowMins) {
      if (!rangeStr) return false;
      const { start, end } = parseRange(rangeStr);
      if (end >= start) return nowMins >= start && nowMins < end;
      return nowMins >= start || nowMins < end;
    }

    function minsUntilStart(rangeStr, nowMins) {
      if (!rangeStr) return Infinity;
      const { start } = parseRange(rangeStr);
      return (start - nowMins + 1440) % 1440;
    }

    function minsSinceEnd(rangeStr, nowMins) {
      if (!rangeStr) return Infinity;
      const { end } = parseRange(rangeStr);
      return (nowMins - end + 1440) % 1440;
    }

    function formatTimeNow() {
      const now = new Date();
      const pad = n => n.toString().padStart(2, "0");
      return `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
    }

    function renderList(id, list, emptyMessage) {
      const el = document.getElementById(id);
      el.innerHTML = "";
      if (list.length === 0) {
        el.innerHTML = `<div class="empty">${emptyMessage}</div>`;
        return;
      }
      list.forEach(txt => {
        const div = document.createElement("div");
        div.className = "shift-row";
        div.textContent = txt;
        el.appendChild(div);
      });
    }

    // Track previous state to detect changes
    let prevInCrib = [];
    let prevDropped = [];

    function arraysChanged(a, b) {
      if (a.length !== b.length) return true;
      const sa = [...a].sort();
      const sb = [...b].sort();
      for (let i = 0; i < sa.length; i++) {
        if (sa[i] !== sb[i]) return true;
      }
      return false;
    }

    function triggerAnimation() {
      const el = document.getElementById("animContainer");
      if (!el) return;
      el.classList.remove("animate");
      // force reflow so animation can restart
      void el.offsetWidth;
      el.classList.add("animate");
    }

    function updateDisplay() {
      const now = new Date();
      const nowMins = now.getHours() * 60 + now.getMinutes();

      const inCrib = [];
      const startingSoon = [];
      const dropped = [];

      for (const s of shifts) {
        // In crib window (Crib 1 OR 2)
        if (isNowInRange(s.crib1, nowMins) || isNowInRange(s.crib2, nowMins)) {
          if (!inCrib.includes(s.shift)) inCrib.push(s.shift);
        }

        // Starting in next 5 minutes
        const d1 = minsUntilStart(s.crib1, nowMins);
        if (d1 > 0 && d1 <= 5) startingSoon.push(`${s.shift} starts soon`);

        const d2 = minsUntilStart(s.crib2, nowMins);
        if (d2 > 0 && d2 <= 5) startingSoon.push(`${s.shift} starts soon`);

        // Dropped out in last 30 mins (no crib labels)
        const end1 = minsSinceEnd(s.crib1, nowMins);
        if (!isNowInRange(s.crib1, nowMins) && end1 > 0 && end1 <= 30) {
          dropped.push(`${s.shift} dropped out ${end1} min ago`);
        }

        const end2 = minsSinceEnd(s.crib2, nowMins);
        if (!isNowInRange(s.crib2, nowMins) && end2 > 0 && end2 <= 30) {
          dropped.push(`${s.shift} dropped out ${end2} min ago`);
        }
      }

      document.getElementById("timeNow").textContent =
        "Current time (from this computer): " + formatTimeNow();

      renderList("inCribList", inCrib, "No shifts currently in crib.");
      renderList("startingSoonList", startingSoon, "No crib windows starting soon.");
      renderList("droppedList", dropped, "No shifts have dropped out recently.");

      // Detect change in crib status or dropped list
      const cribChanged = arraysChanged(inCrib, prevInCrib);
      const droppedChanged = arraysChanged(dropped, prevDropped);

      if (cribChanged || droppedChanged) {
        triggerAnimation();
      }

      prevInCrib = [...inCrib];
      prevDropped = [...dropped];
    }

    updateDisplay();
    setInterval(updateDisplay, 10000); // refresh every 10 seconds
  </script>
</body>
</html>
